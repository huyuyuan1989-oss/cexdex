<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”— è³‡é‡‘æµå‘ä¸»æ§å° | Capital Flow Dashboard</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --accent: #6366f1;
            --green: #22c55e;
            --red: #ef4444;
            --yellow: #fbbf24;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.6;
            padding: 1.5rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            text-align: center;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }

        /* Sentiment Badge */
        .sentiment-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .sentiment-bullish {
            background: var(--green);
            color: #000;
        }

        .sentiment-bearish {
            background: var(--red);
            color: #fff;
        }

        .sentiment-neutral {
            background: var(--yellow);
            color: #000;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-value.green {
            color: var(--green);
        }

        .stat-value.red {
            color: var(--red);
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Tables */
        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th,
        td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        th {
            color: var(--text-muted);
            font-weight: 500;
        }

        .positive {
            color: var(--green);
        }

        .negative {
            color: var(--red);
        }

        .tag {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin: 0.125rem;
        }

        .tag-bullish {
            background: rgba(34, 197, 94, 0.2);
            color: var(--green);
        }

        .tag-bearish {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }

        .tag-neutral {
            background: rgba(251, 191, 36, 0.2);
            color: var(--yellow);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .error {
            text-align: center;
            padding: 2rem;
            color: var(--red);
        }

        .footer {
            text-align: center;
            margin-top: 1rem;
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* Download Button */
        .download-btn {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            margin-top: 1rem;
        }

        .download-btn:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div id="app" class="container">
        <h1>ğŸ”— è³‡é‡‘æµå‘ä¸»æ§å°</h1>
        <p class="subtitle">Capital Flow Dashboard | å³æ™‚æ•¸æ“šä¾†è‡ª data.json</p>

        <!-- Loading State -->
        <div v-if="loading" class="loading">
            â³ è¼‰å…¥æ•¸æ“šä¸­...
        </div>

        <!-- Error State -->
        <div v-else-if="error" class="error">
            âŒ {{ error }}
        </div>

        <!-- Data Loaded -->
        <div v-else>
            <!-- Market Sentiment -->
            <div style="text-align: center;">
                <span class="sentiment-badge" :class="sentimentClass">
                    {{ data.market_sentiment }}
                </span>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">ğŸ’µ ${{ formatB(data.stablecoin_marketcap) }}B</div>
                    <div class="stat-label">ç©©å®šå¹£ç¸½å¸‚å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value"
                        :class="data.cex_flows?.summary?.total_stablecoin_flow_24h > 0 ? 'green' : 'red'">
                        ${{ formatM(data.cex_flows?.summary?.total_stablecoin_flow_24h) }}M
                    </div>
                    <div class="stat-label">CEX ç©©å®šå¹£æµå‘ (24H)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value"
                        :class="data.cex_flows?.summary?.total_btc_eth_flow_24h > 0 ? 'red' : 'green'">
                        ${{ formatM(data.cex_flows?.summary?.total_btc_eth_flow_24h) }}M
                    </div>
                    <div class="stat-label">CEX BTC/ETH æµå‘ (24H)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">â±ï¸ {{ formatTime(data.execution_time_seconds) }}s</div>
                    <div class="stat-label">æ›´æ–°æ™‚é–“: {{ data.generated_at }}</div>
                </div>
            </div>

            <!-- Chain Flows Table -->
            <div class="section">
                <h2 class="section-title">ğŸ”— å…¬éˆè³‡é‡‘æµå‘ <span
                        style="font-size: 0.7rem; color: var(--text-muted);">ï¼ˆé»æ“Šæ¬„ä½æ’åºï¼‰</span></h2>
                <table>
                    <thead>
                        <tr>
                            <th>å…¬éˆ</th>
                            <th @click="sortBy('tvl_total', 'chain')" style="cursor: pointer;">TVL â†•</th>
                            <th @click="sortBy('change_24h_pct', 'chain')" style="cursor: pointer;">24H è®Šå‹• â†•</th>
                            <th @click="sortBy('stable_inflow_24h', 'chain')" style="cursor: pointer;">ç©©å®šå¹£æµå…¥ â†•</th>
                            <th>ä¿¡è™Ÿ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="chain in sortedChains" :key="chain.chain">
                            <td><strong>{{ chain.chain }}</strong></td>
                            <td>${{ formatB(chain.tvl_total) }}B</td>
                            <td :class="chain.change_24h_pct >= 0 ? 'positive' : 'negative'">
                                {{ chain.change_24h_pct >= 0 ? '+' : '' }}{{ chain.change_24h_pct }}%
                            </td>
                            <td :class="chain.stable_inflow_24h >= 0 ? 'positive' : 'negative'">
                                ${{ formatM(chain.stable_inflow_24h) }}M
                            </td>
                            <td>
                                <span v-for="tag in chain.tags" :key="tag.type" class="tag"
                                    :class="getTagClass(tag.signal)">
                                    {{ tag.type }}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- CEX Flows Table -->
            <div class="section">
                <h2 class="section-title">ğŸ¦ äº¤æ˜“æ‰€è³‡é‡‘æµå‘ <span
                        style="font-size: 0.7rem; color: var(--text-muted);">ï¼ˆé»æ“Šæ¬„ä½æ’åºï¼‰</span></h2>
                <table>
                    <thead>
                        <tr>
                            <th>äº¤æ˜“æ‰€</th>
                            <th @click="sortBy('total_tvl', 'cex')" style="cursor: pointer;">TVL â†•</th>
                            <th @click="sortBy('net_flow_24h', 'cex')" style="cursor: pointer;">æ·¨æµå‘ â†•</th>
                            <th @click="sortBy('stablecoin_flow_24h', 'cex')" style="cursor: pointer;">ç©©å®šå¹£ â†•</th>
                            <th @click="sortBy('btc_eth_flow_24h', 'cex')" style="cursor: pointer;">BTC/ETH â†•</th>
                            <th>ä¿¡è™Ÿ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="cex in sortedCex" :key="cex.exchange">
                            <td><strong>{{ cex.exchange }}</strong></td>
                            <td>${{ formatB(cex.total_tvl) }}B</td>
                            <td :class="cex.net_flow_24h >= 0 ? 'positive' : 'negative'">
                                ${{ formatM(cex.net_flow_24h) }}M
                            </td>
                            <td :class="cex.stablecoin_flow_24h >= 0 ? 'positive' : 'negative'">
                                ${{ formatM(cex.stablecoin_flow_24h) }}M
                            </td>
                            <td :class="cex.btc_eth_flow_24h >= 0 ? 'negative' : 'positive'">
                                ${{ formatM(cex.btc_eth_flow_24h) }}M
                            </td>
                            <td>
                                <span v-for="tag in cex.tags" :key="tag.type" class="tag"
                                    :class="getTagClass(tag.signal)">
                                    {{ tag.type }}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Download Links -->
            <div style="text-align: center;">
                <a href="./data.json" class="download-btn" download>ğŸ“¥ ä¸‹è¼‰ JSON å¿«ç…§</a>
                <a href="./history.csv" class="download-btn" download>ğŸ“Š ä¸‹è¼‰æ­·å² CSV</a>
            </div>
        </div>

        <div class="footer">
            <div
                style="max-width: 800px; margin: 0 auto 1rem auto; text-align: left; background: rgba(255,255,255,0.03); padding: 1rem; border-radius: 8px; font-size: 0.75rem; color: #94a3b8;">
                <strong>ï¿½ Methodology & Definitions:</strong><br>
                <ul style="margin-left: 1.2rem; margin-top: 0.5rem;">
                    <li><strong>Buying Power (è³¼è²·åŠ›):</strong> Defined as Net Inflow of Stablecoins (USDT, USDC, DAI) >
                        $50M. Indicates potential accumulation.</li>
                    <li><strong>Dump Risk (æ‹‹å”®é¢¨éšª):</strong> Defined as Net Inflow of Volatile Assets (BTC, ETH) > $100M
                        to Exchanges. Indicates potential selling pressure.</li>
                    <li><strong>Data Source:</strong> Aggregated from DefiLlama & Chain RPCs. Adjusted for price
                        volatility to reflect true token flow.</li>
                </ul>
            </div>
            <p>Powered by DefiLlama API | æ•¸æ“šæ¯ 30 åˆ†é˜è‡ªå‹•æ›´æ–°</p>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    data: {},
                    loading: true,
                    error: null,
                    chainSortKey: 'stable_inflow_24h',
                    chainSortOrder: -1,
                    cexSortKey: 'stablecoin_flow_24h',
                    cexSortOrder: -1
                }
            },
            computed: {
                sentimentClass() {
                    const sentiment = this.data.market_sentiment || '';
                    if (sentiment.includes('Bullish')) return 'sentiment-bullish';
                    if (sentiment.includes('Bearish')) return 'sentiment-bearish';
                    return 'sentiment-neutral';
                },
                sortedChains() {
                    const chains = this.data.chain_flows?.chains || [];
                    return [...chains].sort((a, b) => {
                        const aVal = a[this.chainSortKey] || 0;
                        const bVal = b[this.chainSortKey] || 0;
                        return (aVal - bVal) * this.chainSortOrder;
                    });
                },
                sortedCex() {
                    const exchanges = this.data.cex_flows?.exchanges || [];
                    return [...exchanges].sort((a, b) => {
                        const aVal = a[this.cexSortKey] || 0;
                        const bVal = b[this.cexSortKey] || 0;
                        return (aVal - bVal) * this.cexSortOrder;
                    });
                }
            },
            methods: {
                sortBy(key, tableType) {
                    if (tableType === 'chain') {
                        if (this.chainSortKey === key) {
                            this.chainSortOrder *= -1;
                        } else {
                            this.chainSortKey = key;
                            this.chainSortOrder = -1;
                        }
                    } else {
                        if (this.cexSortKey === key) {
                            this.cexSortOrder *= -1;
                        } else {
                            this.cexSortKey = key;
                            this.cexSortOrder = -1;
                        }
                    }
                },
                formatB(num) {
                    return num ? (num / 1e9).toFixed(2) : '0.00';
                },
                formatM(num) {
                    return num ? (num / 1e6).toFixed(1) : '0.0';
                },
                formatTime(sec) {
                    return sec ? sec.toFixed(2) : '0.00';
                },
                getTagClass(signal) {
                    if (signal === 'Bullish') return 'tag-bullish';
                    if (signal === 'Bearish') return 'tag-bearish';
                    return 'tag-neutral';
                },
                async fetchData() {
                    try {
                        const response = await fetch('./data.json');
                        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥ data.json');
                        this.data = await response.json();
                    } catch (e) {
                        this.error = e.message;
                    } finally {
                        this.loading = false;
                    }
                }
            },
            mounted() {
                this.fetchData();
                // æ¯ 5 åˆ†é˜è‡ªå‹•åˆ·æ–°
                setInterval(() => this.fetchData(), 5 * 60 * 1000);
            }
        }).mount('#app');
    </script>
</body>

</html>